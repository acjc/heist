os:
  - linux

language: android
licenses:
  - 'android-sdk-preview-license-.+'
  - 'android-sdk-license-.+'
  - 'google-gdk-license-.+'
android:
  components:
    - tools
    - platform-tools
    - build-tools-27.0.3
    - build-tools-28.0.2
    - android-27
    - android-28
    - sys-img-armeabi-v7a-google_apis-28
    - extra-android-m2repository
    - extra-google-m2repository
    - extra-google-android-support
jdk: oraclejdk8

sudo: false

addons:
  apt:
    # Flutter depends on /usr/lib/x86_64-linux-gnu/libstdc++.so.6 version GLIBCXX_3.4.18
    sources:
      - ubuntu-toolchain-r-test # if we don't specify this, the libstdc++6 we get is the wrong version
    packages:
      - libstdc++6
      - fonts-droid

before_install:
  - openssl aes-256-cbc -K $encrypted_c7a4618bb56c_key -iv $encrypted_c7a4618bb56c_iv -in secrets.tar.enc -out secrets.tar -d
  - tar xvf secrets.tar

before_script:
  - git clone https://github.com/flutter/flutter.git -b beta
  - ./flutter/bin/flutter doctor

script:
  - ./flutter/bin/flutter test
  - ./flutter/bin/flutter build apk

deploy:
  provider: gcs
  bucket: $BUCKET
  upload-dir: releases
  access_key_id:
    secure: "YkzThC1ldlytZ+8MDDjce1VrW0bFpAx73rLxPIpwY7trNvUMDBFx0q8N/WjyS0w7EPnve39tfRsA91mqFsB7rIeFovSBhr2PY7zZrol8GlMSJ4vDFZq9+JEDNJHEfcBONo/9rgbWq2OnVzSvE1irTxZvn0Ldk3W/GV2MdeU2GdE81KnFMvsZWlMwT/rOcLLUqzCmYVVEhOo43XddVvL7GLJhmXMVWXxNUMNZkrRwE/DE67RgeCplbqKjZrB0LKev/H4h5R5kYxj+kUjeE+so67RJMZLTp8h8WnkLqLXz2s41ugO3xa2waOR2+OGZ7A00bpvIx33ftuFPW+IxQyJYYMinGHyv1QPGcRYp2DHfr6b3hUD5t1Ff27bc9QeXJh1iRBcfYyE3F7zV2IGQXohCE4+FUSj+9xNtlEhufYJt7ogwpOfZcgOmoyfeiOlcaTKpUk17zPEbDE+dhpZZy9bAHzgKENLfkk61GdNeCmybi8uTuX4jwhGiO5fgk/nuE2UPt1UVOzZdFaAuAoeQcIVLyeIUiHy6hALTVWDb8m2uoOYHbF66MEwaNivirjq9tu1fkzAyTDq0yBSCU7waIgxZ/8UyuBzUY+zs5eUGWirhH1waAWrjy/nRRI/2VCLmmUxUykwO4f7BrF1+KMH27XYvPMFBTTesFEmAL34UOE577o0="
  secret_access_key:
    secure: "GFYGONK8OzRnKgTjFk0iNtDDO2KEss6bM5euwO1fKKibigNyB+Dx7ilB8nzHQPrBBD92vEIOTrtOJ4h+vZMALcNpVWrcZ+/7v+kqPotnOjSP67hIf4i2iOmy0TjiL2XxeachMuwVWj+VpEp0hTXaI/laFiUeXr2B7u0NTGesZQR0zczBBeOwukweYKOkukgWgxQyBmKGJoaAT8fFa8SvBj0MOkseaRoWOQ0diJpFvinNCaK9rqr30BOq6uPmmdRaRbRQXtD5b7vXHxw/BCV1uf4QiYRf6CrUiBSJQNVk4fnisljdd4P79cCDuMecskOzEoo+MHMVQXh9XWUf3AYHiitPk0nHe0tA7yOquz5h551LdSFzUhVCnQwT0hv2yt+BKNnxnzIOefYGWQKIGRD6hbUanXKcmc/uJLSdMBBjiIuLfxAi6pFUkqC7Hu1b2czyQj2Dtn3XxKWu/qH5iBT5SumMUo8ogvwl4UpxRMp+IT6oIZAiPLTl9+aTDQ6rUPNTjWV6B/UZw5YCfOAiqdH00NWKr1cX71/2gF6QJwEXe/F4RGnrHWYsqhp1VHdjmkMoYBqVmSexrfXcykB/e0w4LyYiWHKt/OYgMvBjlG/w0+4USoFVPtDHp03rMMb0puWFJTL1rkXNzOcXsj5rL1C/aehM8RxYIcvIOTzYx35KQsE="
  skip_cleanup: true
  local-dir: ./build/app/outputs/apk/release
  on:
    all_branches: true

cache:
  directories:
    - $HOME/.pub-cache

env:
  global:
    # ANDROID_KEY_ALIAS
    - secure: "TQllWJ6ITrg9ueW0jQUdKN55uChkkDBPdQq51oi+QizlLl6sc5gchF+oyNdhDU83WnFZyEp04o8m2V9AM/7iioNLINRXu6WjjQkK0aV9jPXgFZySAXHSwkR9PZ6lvKmq1ORRLkKD3g8bH4VkIuB2q3b87f23f6fadiGl0lGq92fSkvgSoh2wX2+hHCrvW/93QCCPTygSnJJ+JyQSorSrdi7eDWXCkzItytiF4aTGgqnIyvLnMFxLk+ZJnhKqUf5kfQ6zU3gACQrucS8UMQr3oliG6lkBdKcLf3S96BJlkqqOVWLhi+rIdgW93YO/LK1SF2VXNUVkCFcoODW5eB37ZgA0b509aYTwbeAQXTiXWEb3ehutNeVs5wledfpUD4FmNt57yYYMBCfe/vZYU0AYvcjkwXkOwwx3zzzB/FSX6aXhm9Cn6malYmJEl7WO/bfTdh25zBIkoUMWr1pw4nYGN54n+qxlgH0xe6J+cleuDlc56jaRyldExmV1MQ5ZjWNfGngIaLqD+kzDIc8jwcshTBioNmYMVXrFQAdJQrd5dU1OG3lPZFYkTG9yHvHfwbZXPEqEGKmM1fsKm0MyohVl6hQF9mWkoqcU9vIPTinw/YBZUCWARWut7FcrgWrg19F0yCrkQShNaId73tB1kDqBB0SAi46jfm4GvxgJuvNCR+Y="
    # ANDROID_KEY_PASSWORD
    - secure: "YkF/m8WZ6h1L2V5U+AvUeEo7FwvnM/8ScdHcYO9ipGuwWExp6W2JZe+kP9pDq+NMrF1eFDymnpUT6nPNI20IK/T79jopY78P2hFtk6LEIQxILN9apHYTGH7F7mTrQ2VHWCGPWWtfeVMqeouoSSWEqg/oCDESyZZ+SMvzDMNEs5PQ+fpIiB/KAyO5qKLVrmbpDhdXeMHKOX3ZzpP1+l3v+/wpn9lZH9Ze/B2MK9KoppmbztrqLSaG3vHMvKJ5UMctWomU82PL/T7ZbfvXbEH7p2x9hg3BDdoaoFZ0ptLJIn+Fdel5fgYpMbu4/RTOMndL3MYuky6Gwcj8uQhXBrTyILlMUpTvwPGfB2JlSAetTV7yY+xI8kfxYS6d7Rso+iqUBmNmeVTPgeZ6ttM1vMsG5yV8oMtto+K+FyDDSL61bmw3WjHl53LxEM46vHn9Z0ECoX9DpYk7ZTZQBYOFoaydeuXVOahs93YUSMMZSw1uSAce8WfoWHf7RCNzxra/Ju490Ebq3zt5h9CSVxEaV7FLpHcdnN914DyzuDgq5eF26t0yYg+DZChisZilotold93YhOpH+o9ZpXXQ+8pXwnXos5oAu/+eOe62bfdsJ55S0+MCvd50Yie5ZGBPtRP61qSVEQ/elxwC0ZbsT4n1J8TfDT1PGCa6l2PgzI1cDZQyClk="
    # BUCKET
    - secure: "A/77eHQDqOPPZ2TfEZuC+8ZlPOp0wJhHhQRgUBj/dG6XWHtqyw3ZrJKYwfvGSAyvKH5IllJELvgJqKsOTmLt6yAVW2mmz3AiRtsGQTMCzHVzSYbKtYhq6Ji1UU6/Pl0nr3t7MiEpg2nboRE3hzqm2+vQezDeVWPrfR58CSfk11iMy9Jr/m0LDzhP9s5ZdOUYjtxBUNK8cfX68JkBncLlXHQO6IZhdCtxxMDguD0zZnP8Ng+ibpB2jirXzGFk6y6o5XKfHtPi2RBq+baPM7erDk58u8wJ+fhXXCfC9Oxyo+kwl0aAmIIC4xGYHThdZrgUWq18dCrVy4Y3VOmt5vH4EZhil0u+LM1ihvkM/vg5DXd9whZk+7fm7eVTzpTSZJ7mDnh1i8kg8lpJeGX+ZFiMFmo2Sxl/3+y2dZ1Ydy7fiFGjM5MHVjxEuI05fkDGY4OaZWU/t4bkHV+V5zVQ/s84PtVC8XllP+4y38Z61cZNSIrtZhBTg0s21reF+RfyoFkJjVwkrAz2AIIfcVLesMpXVgcO43H5VgAUSOtEYSLH9wVjz7ocUAGNzQR2vPE/rfM2v+O+v/DN9armc610pZgC4gvTB0duw7jdABAdm4Rgk7oc8RvhwTqFPmQeksVbKclnxRgf3I6i2nVCFAgT4eSFPuwuk4vLT6kXdyGDNiKaDJY="
